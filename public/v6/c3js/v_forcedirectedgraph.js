function updateVtypeChange(t){json_source=JSON.parse(t);var e=json_source;svg.selectAll("*").remove(),start(e)}function start(t){var e=flatten(t),r=d3.layout.tree().links(e),n=packages.imports(e);n.forEach(function(t){r.push(t)}),r.forEach(function(t){t.value=t.target.value?t.target.value:parseInt(9*Math.random()+1)}),force.nodes(e).links(r).start();var a=svg.selectAll(".link").data(r).enter().append("line").attr("class","link").style("stroke-width",function(t){return Math.sqrt(t.value)}),o=svg.selectAll(".d3node").data(e).enter().append("circle").attr("class","d3node").attr("r",5).style("fill",function(t){return color(t.group?t.group:parseInt(4*Math.random()+1))}).call(force.drag);o.append("title").text(function(t){return t.name}),force.on("tick",function(){a.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),o.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})})}function flatten(t){function e(t){return t.children&&(t.size=t.children.reduce(function(t,r){return t+e(r)},0)),t.id||(t.id=++n),r.push(t),t.size}var r=[],n=0;return t.size=e(t),r}width=ow,height=oh;var color=d3.scale.category20(),force=d3.layout.force().charge(-120).linkDistance(30).size([width,height]);svg&&svg.remove(),svg=d3.select("#chat").append("svg").attr("width",width).attr("height",height),function(){packages={imports:function(t){var e={},r=[];return t.forEach(function(t){e[t.name]=t}),t.forEach(function(t){t.imports&&t.imports.forEach(function(n){r.push({source:e[t.name],target:e[n.substring(n.lastIndexOf(".")+1)]})})}),r}}}(),json_source?start(json_source):d3.json(document.getElementById("jsonsource").value,function(t,e){if(t)throw t;start(e)});