function x(t){return t.income}function y(t){return t.lifeExpectancy}function radius(t){return t.population}function color(t){return t.region}function key(t){return t.name}document.getElementById("jsonsource").value="nations.json",document.getElementById("yarn_jsonsource").value&&(document.getElementById("jsonsource").value=document.getElementById("yarn_jsonsource").value);var margin={top:19.5,right:19.5,bottom:19.5,left:19.5},width=ow-margin.right,height=oh-margin.top-margin.bottom,xScale=d3.scale.log().domain([300,1e5]).range([0,width]),yScale=d3.scale.linear().domain([10,85]).range([height,0]),radiusScale=d3.scale.sqrt().domain([0,5e8]).range([0,40]),colorScale=d3.scale.category10(),xAxis=d3.svg.axis().orient("bottom").scale(xScale).ticks(12,d3.format(",d")),yAxis=d3.svg.axis().scale(yScale).orient("left");svg&&svg.remove(),svg=d3.select("#chat").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),svgg=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),svgg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis),svgg.append("g").attr("class","y axis").call(yAxis);var label;d3.json(document.getElementById("jsonsource").value,function(t){function e(t){t.attr("cx",function(t){return xScale(x(t))}).attr("cy",function(t){return yScale(y(t))}).attr("r",function(t){return radiusScale(radius(t))})}function a(t,e){return radius(e)-radius(t)}function n(){function t(){label.classed("active",!0)}function e(){label.classed("active",!1)}function a(){o(n.invert(d3.mouse(this)[0]))}var n=d3.scale.linear().domain([1800,2009]).range([u.x+10,u.x+u.width-10]).clamp(!0);svgg.transition().duration(0),d.on("mouseover",t).on("mouseout",e).on("mousemove",a).on("touchmove",a)}function r(){var t=d3.interpolateNumber(1800,2009);return function(e){o(t(e))}}function o(t){s.data(i(t),key).call(e).sort(a),label.text(Math.round(t))}function i(e){return t.children.map(function(t){return{name:t.name,region:t.region,income:c(t.income,e),population:c(t.population,e),lifeExpectancy:c(t.lifeExpectancy,e)}})}function c(t,e){var a=l.left(t,e,0,t.length-1),n=t[a];if(a>0){var r=t[a-1],o=(e-n[0])/(r[0]-n[0]);return n[1]*(1-o)+r[1]*o}return n[1]}svgg.append("text").attr("class","x label").attr("text-anchor","end").attr("x",width).attr("y",height-6).text(t.xunit),svgg.append("text").attr("class","y label").attr("text-anchor","end").attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").text(t.yunit),label=svgg.append("text").attr("class","year label").attr("text-anchor","end").attr("y",height-24).attr("x",width).text(t.init);var l=d3.bisector(function(t){return t[0]}),s=svgg.append("g").attr("class","dots").selectAll(".dot").data(i(1800)).enter().append("circle").attr("class","dot").style("fill",function(t){return colorScale(color(t))}).call(e).sort(a);s.append("title").text(function(t){return t.name});var u=label.node().getBBox(),d=svgg.append("rect").attr("class","overlay").attr("x",u.x).attr("y",u.y).attr("width",u.width).attr("height",u.height).on("mouseover",n);svgg.transition().duration(3e4).ease("linear").tween("year",r).each("end",n)});