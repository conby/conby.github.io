function start(t){node=root=t;var e=treemap.nodes(root).filter(function(t){return!t.children}),n=svgg.selectAll("g").data(e).enter().append("svg:g").attr("class","cell").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).on("click",function(t){return zoomaxx(node==t.parent?root:t.parent)});n.append("svg:rect").attr("width",function(t){return t.dx-1}).attr("height",function(t){return t.dy-1}).style("fill",function(t){return color(t.parent.name)}),n.append("svg:text").attr("x",function(t){return t.dx/2}).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.name}).style("opacity",function(t){return t.w=this.getComputedTextLength(),t.dx>t.w?1:0}),d3.select(window).on("click",function(){zoomaxx(root)}),d3.select("#select_treemap").on("change",function(){treemap.value("size"==this.value?sizeax:countax).nodes(root),zoomaxx(node)})}function updateVtypeChange(t){json_source=JSON.parse(t);var e=json_source;svg.selectAll("*").remove(),svgg=svg.append("svg:g").attr("transform","translate(.5,.5)"),start(e)}function sizeax(t){return t.size}function countax(t){return 1}function zoomaxx(t){var e=w/t.dx,n=h/t.dy;x.domain([t.x,t.x+t.dx]),y.domain([t.y,t.y+t.dy]);var r=svgg.selectAll("g.cell").transition().duration(d3.event.altKey?7500:750).attr("transform",function(t){return"translate("+x(t.x)+","+y(t.y)+")"});r.select("rect").attr("width",function(t){return e*t.dx-1}).attr("height",function(t){return n*t.dy-1}),r.select("text").attr("x",function(t){return e*t.dx/2}).attr("y",function(t){return n*t.dy/2}).style("opacity",function(t){return e*t.dx>t.w?1:0}),node=t,d3.event.stopPropagation()}document.getElementById("treemap_select").style.display="",w=ow,h=oh;var x=d3.scale.linear().range([0,w]),y=d3.scale.linear().range([0,h]),color=d3.scale.category20c(),treemap=d3.layout.treemap().round(!1).size([w,h]).sticky(!0).value(function(t){return t.size});svg&&svg.remove(),svg=d3.select("#chat").append("svg:svg").attr("width",w).attr("height",h),svgg=svg.append("svg:g").attr("transform","translate(.5,.5)"),json_source?start(json_source):d3.json(document.getElementById("jsonsource").value,function(t){start(t)});