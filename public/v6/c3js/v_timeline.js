function updateVtypeChange(t){var e=t.split(" ");y=0,e.length<3&&isNaN(parseInt(t))||(e.length>3?y=parseInt(e[0])+parseInt(e[2]):y=parseInt(t.replace(/\.\.\./,"")),isNaN(y)||(0==timeline_max&&(v1=[]),v1.length>500&&v1.splice(0,1),y>timeline_max&&(timeline_max=y),v1.push({x:(new Date).getTime(),y:y,xlabel:(new Date).format("hh:mm:ss")}),v1.forEach(function(t){timeFormat[t.x]=t.xlabel}),registerTimeline(0,timeline_max),registerHistogram(v1.map(function(t){return t.y}),0,timeline_max),drawTimeline("#chat",v1,v1[0].x,v1[v1.length-1].x,0,timeline_max,timeline_yunit),registerTimeline(0,timeline_max),drawHistogram("#chat",v1.map(function(t){return t.y}),0,timeline_max,timeline_yunit)))}function showBootstrapTooltip(t,e){$(t).tooltip({title:e,trigger:"manual",container:"#chat"}),$(t).tooltip("show")}function hideBootstrapTooltip(t){$(t).tooltip("destroy")}function registerTimeline(t,e){var a=yValueFormat(e).length,n=8*a+10;maxMarginLeftForTimeline=n>maxMarginLeftForTimeline?n:maxMarginLeftForTimeline}function registerHistogram(t,e,a){var n=d3.layout.histogram().range([e,a]).bins(histogramBinCount)(t),r=d3.max(n,function(t){return t.y});maxXForHistogram=r>maxXForHistogram?r:maxXForHistogram}function drawLine(t,e,a,n,r,i,o){var l=d3.svg.line().x(function(t){return e(t.x)}).y(function(t){return a(t.y)}),s=[{x:n,y:r},{x:i,y:o}];t.append("path").datum(s).style("stroke-dasharray","6, 6").style("stroke","lightblue").attr("class","line").attr("d",l)}function drawTimeline(t,e,a,n,r,i,o,l){function s(t){return"true"==$("#batch-"+t).attr("isFailed")}var c={top:60,right:27,bottom:30,left:maxMarginLeftForTimeline},m=ow-c.left-c.right,u=250-c.top-c.bottom,d=d3.scale.linear().domain([a,n]).range([0,m]),g=d3.scale.linear().domain([r,i]).range([u,0]),f=d3.svg.axis().scale(d).orient("bottom").tickFormat(function(t){var e=timeFormat[t],a=e.indexOf(".");return a>=0?e.substring(0,a):e}),p=d3.format(",.2f"),h=d3.svg.axis().scale(g).orient("left").ticks(5).tickFormat(p),x=d3.svg.line().x(function(t){return d(t.x)}).y(function(t){return g(t.y)});svg&&0==timeline_max&&svg.remove(),svg&&timeline_max>0?svg.selectAll("*").remove():svg=d3.select(t).append("svg").attr("width",m+c.left+c.right).attr("height",u+250+c.top+c.bottom);var v=svg.append("g").attr("transform","translate("+c.left+","+(c.top+190)+")");f.tickValues(d.domain()),v.append("g").attr("class","x axis").attr("transform","translate(0,"+u+")").call(f),v.append("g").attr("class","y axis").call(h).append("text").attr("transform","translate(0,"+unitLabelYOffset+")").text(o),l&&l<=i&&drawLine(svg,d,g,a,l,n,l),v.append("path").datum(e).attr("class","line").attr("d",x);var y=null,w=null;v.selectAll(".point").data(e).enter().append("circle").attr("stroke",function(t){return s(t.x)?"red":"white"}).attr("fill",function(t){return s(t.x)?"red":"white"}).attr("opacity",function(t){return s(t.x)?"1":"0"}).style("cursor","pointer").attr("cx",function(t){return d(t.x)}).attr("cy",function(t){return g(t.y)}).attr("r",function(t){return s(t.x)?"2":"0"}).on("mouseover",function(t){var e=p(t.y)+" "+o+" at "+timeFormat[t.x];showBootstrapTooltip(d3.select(this).node(),e),d3.select(this).attr("stroke",function(t){return s(t.x)?"red":"steelblue"}).attr("fill",function(t){return s(t.x)?"red":"steelblue"}).attr("opacity","1").attr("r","3")}).on("mouseout",function(){hideBootstrapTooltip(d3.select(this).node()),d3.select(this).attr("stroke",function(t){return s(t.x)?"red":"white"}).attr("fill",function(t){return s(t.x)?"red":"white"}).attr("opacity",function(t){return s(t.x)?"1":"0"}).attr("r",function(t){return s(t.x)?"2":"0"})}).on("click",function(t){null!=w&&window.clearTimeout(w),null!=y&&(clearBatchRow(y),y=null),y=t.x,highlightBatchRow(y),w=window.setTimeout(function(){w=null,null!=y&&(clearBatchRow(y),y=null)},3e3);var e=$("#batch-"+t.x),a=e.offset().top-15;a<0&&(a=0),$("html,body").animate({scrollTop:a},200)})}function drawHistogram(t,e,a,n,r,i){var o={top:60,right:30,bottom:30,left:maxMarginLeftForTimeline},l=ow-o.left-o.right,s=250-o.top-o.bottom,c=d3.scale.linear().domain([0,maxXForHistogram]).range([0,l-50]),m=d3.scale.linear().domain([a,n]).range([s,0]),u=d3.svg.axis().scale(c).orient("top").ticks(5),d=d3.svg.axis().scale(m).orient("left").ticks(0).tickFormat(function(t){return""}),g=d3.format(",.2f"),d=d3.svg.axis().scale(m).orient("left").ticks(5).tickFormat(g),f=d3.layout.histogram().range([a,n]).bins(histogramBinCount)(e),p=svg.append("g").attr("transform","translate("+o.left+","+(o.top+0)+")");if(i&&i<=n&&drawLine(svg,c,m,0,i,maxXForHistogram,i),p.append("g").attr("class","x axis").call(u).append("text").attr("transform","translate("+(o.left+l-45)+", "+unitLabelYOffset+")").text("#batches"),p.append("g").attr("class","y axis").call(d).append("text").attr("transform","translate(0,"+unitLabelYOffset+")"),p.selectAll(".bar").data(f).enter().append("g").attr("transform",function(t){return"translate(0,"+(m(t.x)-s+m(t.dx))+")"}).attr("class","bar").append("rect").attr("width",function(t){return c(t.y)}).attr("height",function(t){return s-m(t.dx)}).on("mouseover",function(t){var a=yValueFormat(100*t.y/e.length)+"%",n=t.y+" batches ("+a+") between "+yValueFormat(t.x)+" and "+yValueFormat(t.x+t.dx)+" "+r;showBootstrapTooltip(d3.select(this).node(),n)}).on("mouseout",function(){hideBootstrapTooltip(d3.select(this).node())}),i&&i<=n){var h=c(maxXForHistogram)-20,x=m(i)+15;p.append("text").style("fill","lightblue").attr("class","stable-text").attr("text-anchor","middle").attr("transform","translate("+h+","+x+")").text("stable").on("mouseover",function(t){var e="Processing Time <= Batch Interval ("+yValueFormat(i)+" "+r+")";showBootstrapTooltip(d3.select(this).node(),e)}).on("mouseout",function(){hideBootstrapTooltip(d3.select(this).node())})}}function highlightBatchRow(t){$("#batch-"+t).parent().addClass("batch-table-cell-highlight")}function clearBatchRow(t){$("#batch-"+t).parent().removeClass("batch-table-cell-highlight")}document.getElementById("jsonsource").value="timeline.json",document.getElementById("yarn_jsonsource").value&&(document.getElementById("jsonsource").value=document.getElementById("yarn_jsonsource").value);var maxMarginLeftForTimeline=0,maxXForHistogram=0,histogramBinCount=10,yValueFormat=d3.format(",.2f"),unitLabelYOffset=-10,timeline_max=0,timeline_yunit="",v1=[],timeFormat={};d3.json(document.getElementById("jsonsource").value,function(t){v1=t.children,v1.forEach(function(t){timeFormat[t.x]=t.xlabel}),timeline_yunit=t.yunit,registerTimeline(0,15335),registerHistogram(v1.map(function(t){return t.y}),0,15335),navigator.userAgent.match(/mobile/i)&&($(".d3-draw-area")[0].style.height="446px"),drawTimeline("#chat",v1,1461836722e3,1461838722e3,0,15335,t.yunit),registerTimeline(0,15335),drawHistogram("#chat",v1.map(function(t){return t.y}),0,15335,t.yunit)}),$(function(){var t=window.localStorage&&"true"==window.localStorage.getItem("show-streams-detail");$("span.expand-input-rate").click(function(){t=!t,$("#inputs-table").toggle("collapsed"),$(this).find(".expand-input-rate-arrow").toggleClass("arrow-open").toggleClass("arrow-closed"),window.localStorage&&window.localStorage.setItem("show-streams-detail",""+t)}),t&&($("#inputs-table").toggle("collapsed"),$(this).find(".expand-input-rate-arrow").toggleClass("arrow-open").toggleClass("arrow-closed"))});