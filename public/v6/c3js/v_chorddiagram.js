function groupTicks(t){var e=(t.endAngle-t.startAngle)/t.value;return d3.range(0,t.value,1e3).map(function(a,n){return{angle:a*e+t.startAngle,label:n%5?null:a/1e3+"k"}})}function fade(t){return function(e,a){svgg.selectAll(".chord path").filter(function(t){return t.source.index!=a&&t.target.index!=a}).transition().style("opacity",t)}}var matrix_name=["black","brown","blond","red"],matrix=[[11975,5871,8916,2868],[1951,10048,2060,6171],[8010,16145,8090,8045],[1013,990,940,6907]];try{jsonData=JSON.parse(document.getElementById("yarn_jsonsource").value),jsonData&&"object"==typeof jsonData&&(matrix_name=jsonData.matrix_name,matrix=jsonData.matrix_data)}catch(t){}var chord=d3.layout.chord().padding(.05).sortSubgroups(d3.descending).matrix(matrix);width=ow,height=oh;var innerRadius=.41*Math.min(width,height),outerRadius=1.1*innerRadius,fill=d3.scale.ordinal().domain(d3.range(4)).range(["#000000","#FFDD89","#957244","#F26223"]);svg&&svg.remove(),svg=d3.select("#chat").append("svg").attr("width",width).attr("height",height),svgg=svg.append("g").attr("transform","translate("+width/2+","+height/2+")"),svgg.append("g").selectAll("path").data(chord.groups).enter().append("path").style("fill",function(t){return fill(t.index)}).style("stroke",function(t){return fill(t.index)}).attr("d",d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius)).on("mouseover",fade(.1)).on("mouseout",fade(1)),svgg.selectAll("text").data(chord.groups).enter().append("text").each(function(t,e){t.angle=(t.startAngle+t.endAngle)/2,t.name=matrix_name[e]}).attr("dy",".35em").attr("transform",function(t){return"rotate("+180*t.angle/Math.PI+")translate(0,"+-1*(outerRadius+38)+")"+(t.angle>3*Math.PI/4&&t.angle<5*Math.PI/4?"rotate(180)":"")}).text(function(t){return t.name});var ticks=svgg.append("g").selectAll("g").data(chord.groups).enter().append("g").selectAll("g").data(groupTicks).enter().append("g").attr("transform",function(t){return"rotate("+(180*t.angle/Math.PI-90)+")translate("+outerRadius+",0)"});ticks.append("line").attr("x1",1).attr("y1",0).attr("x2",5).attr("y2",0).style("stroke","#000"),ticks.append("text").attr("x",8).attr("dy",".35em").attr("transform",function(t){return t.angle>Math.PI?"rotate(180)translate(-16)":null}).style("text-anchor",function(t){return t.angle>Math.PI?"end":null}).text(function(t){return t.label}),svgg.append("g").attr("class","chord").selectAll("path").data(chord.chords).enter().append("path").attr("d",d3.svg.chord().radius(innerRadius)).style("fill",function(t){return fill(t.target.index)}).style("opacity",1);