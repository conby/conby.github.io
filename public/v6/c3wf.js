function showTask(t){if(t.taskkey){$("#three form input").val(t.taskkey),document.getElementById("task_desc").style.display="",document.getElementById("runtimes").style.display="",document.getElementById("wf_task_name").innerText=t.taskname,document.getElementById("wf_task_created").innerText=t.created,document.getElementById("wf_task_fcount").innerText=t.fcount;var e=document.getElementById("runtimes");e.innerHTML='<h2 class="comments">Runtime(s)</h2>';for(var s=0;s<t.runtime_list.length;s++)createRuntimeDiv(s+1,t.runtime_list[s]),createRuntime(s+1,t.runtime_list[s]);readonly_wf=t.readonly,"undefined"==typeof readonly_wf&&(readonly_wf=1)}}function createRuntime(t,e){var s=Joint.dia.devs,r=s.arrow,n=[600,20,100,220,130,450,100];navigator.userAgent.match(/mobile/i)&&(n=[333,20,50,120,80,255,50]),setC3WorldDimension(n[0],68,"c3workflow_world"+t.toString());var a=e;a.source.p1.push("in"),a.follower.p1.push("out");var i=s.Model.create({rect:{x:n[3],y:10,width:n[4],height:40},label:a.name,attrs:{fill:"green"},labelAttrs:{"font-weight":"bold",fill:"white","font-size":"12px"},shadow:!0,iPorts:a.source.p1.unique(),oPorts:a.follower.p1.unique()}),o=0,l=0,c=35;for(var d in a.source.rt){a.source.rt[d].p1.push("out"),l=10+o*c,o+=1;var u=s.Model.create({rect:{x:n[1],y:l,width:n[2],height:30},label:a.source.rt[d].runtime_name,labelAttrs:{"font-weight":"bold",fill:"white","font-size":"12px"},attrs:{fill:"red"},shadow:!0,iPorts:["in"],oPorts:a.source.rt[d].p1.unique()});u.wrapper.dblclick(function(t){document.location="#"+a.source.rt[d].taskkey});for(var f in a.source.rt[d].p2)u.port("o",f).joint(i.port("i",a.source.rt[d].p2[f]),r)}o=0,l=0;for(var d in a.follower.rt){a.follower.rt[d].p1.push("in"),l=10+o*c,o+=1;var m=s.Model.create({rect:{x:n[5],y:l,width:n[6],height:30},label:a.follower.rt[d].runtime_name,attrs:{fill:"red"},labelAttrs:{"font-weight":"bold",fill:"white","font-size":"12px"},shadow:!0,iPorts:a.follower.rt[d].p1.unique(),oPorts:["out"]});m.wrapper.dblclick(function(t){document.location="#"+a.follower.rt[d].taskkey});for(var f in a.follower.rt[d].p2)i.port("o",f).joint(m.port("i",a.follower.rt[d].p2[f]),r)}}function createRuntimeDiv(t,e){var s='\t<div class="comment comment-published odd">';s+='\t  <div class="clear-block">',s+='\t\t<span class="submitted" style="float: right">'+e.updated+" - "+e.status+"</span>",s+="\t\t<h4>"+e.key+"</h4>",s+='\t\t<div class="content">',s+="\t\t  <p>   ",s+='\t\t   <table width="100%" border="0" cellpadding="0" cellspacing="1" class="wftab">';for(var r=0;r<e.content.length;r++){var n=e.content[r][0]?":":"",a=$("<div/>").text(e.content[r][1]).html();s+='\t\t      <tr><td class="wftdl" nowrap>'+e.content[r][0]+n+'</td></td><td class="wftdm">&nbsp;</td><td class="wftdr" nowrap>'+a+"</td></tr>"}s+="          </table>",s+="\t\t  </p>",s+="\t\t</div>",s+='\t\t<div id="c3workflow_world'+t.toString()+'"></div>',s+="\t  </div>",s+='\t  <div class="links">',s+='\t\t<ul class="links">',s+='\t\t  <li class="rt_stop first" style="display:inline"><a href="javascript:sendWfMessage(\'c3_stop_runtime\',\''+e.key+"');\"> Stop</a></li>",s+='\t\t  <li class="rt_delete first" style="display:inline"><a href="javascript:sendWfMessage(\'c3_delete_runtime\',\''+e.key+"');\"> Delete</a></li>",s+='\t\t  <li class="rt_activate" style="display:inline"><a href="javascript:sendWfMessage(\'c3_activate_runtime\',\''+e.key+"');\"> Activate</a></li>",s+='\t\t  <li class="rt_promote" style="display:inline"><a href="javascript:sendWfMessage(\'c3_promote_runtime\',\''+e.key+"');\"> Promote</a></li>",s+='\t\t  <li class="rt_logs last" style="display:inline"><a href="javascript:return false;"> Logs </a></li>',s+="\t\t</ul>",s+="\t  </div>",s+="\t</div>";var i=document.getElementById("runtimes"),o=document.createElement("div");o.innerHTML=s,i.appendChild(o)}function sendWfMessage(t,e){if(0!=readonly_wf&&"c3_get_task"!=t&&"c3_request_task"!=t)return void c3Notify("info","access rejected!","center top");var s=$("#three form input").val();if(s){var r=e;r||(r=s);var n={uid:document.getElementById("username").value,message:{api:t,key:r}};n.uid&&n.message&&client&&client.send("/queue/hook_event_queue",{"reply-to":"/temp-queue/foo","c3-user":username,"c3-md5":usermd5,"c3-type":"request_task","c3-format":"json","c3-mod":"workflow"},JSON.stringify(n))}}function setC3WorldDimension(t,e,s){var r=document.getElementById(s);r.style.width=t+"px",r.style.height=e+"px",Joint.paper(s,t,e+150)}function startWorkflowApp(){var t="",e='<h2 class="comments">Runtime(s)</h2>';t+='            <span id="wf_task_created" class="submitted">0000-00-00 00:00</span>',t+='            - <span id="wf_task_fcount">0</span>',t+='            Subscription(s) <br id="br1" class="br1">',t+="            <a href=\"javascript:sendWfMessage('c3_stop_task','');\" title=\"\">Stop</a>",t+="            / <a href=\"javascript:sendWfMessage('c3_request_task','');\" title=\"\">Request</a>",t+="            <a href=\"javascript:sendWfMessage('c3_get_task','');\" style=\"float: right\">Refresh</a>",document.getElementById("task_desc").innerHTML=t,document.getElementById("runtimes").innerHTML=e,$("#three form").keydown(function(t){if(13==t.keyCode)return sendWfMessage("c3_get_task",""),!1})}